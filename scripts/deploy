#!/bin/bash

if [ -z "$1" ] 
then
  echo "âŒ Required to provide Heroku APP_NAME ðŸ˜¬"
  exit 0
fi

APP_NAME=$1

deploy() {
  echo "Deploying your app $APP_NAME to Heroku...ðŸ“¡"
  echo "> Step 1: Building Docker image..."
  heroku container:push web -a $APP_NAME
  echo "> Step 1: Done âœ…"

  echo "> Step 2: Releasing.."
  heroku container:release web -a $APP_NAME
  echo "> Step 2: Done âœ…"

  echo "> Step 3: Deploying Prisma schema..."
  heroku run npm run prisma:deploy -a $APP_NAME
  echo "> Step 3: Done âœ…"
  echo "Deployed '$APP_NAME' success ðŸ¤©ðŸŽ‡âœ¨ðŸŽ‰"
}

WHO_AM_I=$(heroku whoami 2> /dev/null)

if [[ -z $WHO_AM_I ]]; then
  echo "â›” You're logged in. Please login"

  # Login heroku 
  heroku login

  # Login heroku registry
  heroku container:login
fi

deploy